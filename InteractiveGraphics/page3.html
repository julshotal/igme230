<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="PractStyle.css" href="styles.css">
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa|EB+Garamond" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="js/build/three.js"></script>
    <script src="js/Water.js"></script>
    <script src="js/Water2.js"></script>
    <script src="js/build/OrbitControls.js"></script>
    <script src="js/Reflector.js"></script>
    <script src="js/Refractor.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
        <div class="wrapper">
                <div class="header">
                    <h3>DUSK</h3>
                    <a class="button" href="">About This Site</a>
                    <a class="button" href="">THREE.js</a>
                </div>
                <div id="page3">
                    <a class="down" href="doc.html">down</a>
                 </div>
        </div>

        <script>
            //page 3
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera( 110, window.innerWidth / window.innerHeight, 0.1, 10000 );
            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize( window.innerWidth, window.innerHeight );

            let container2 = document.querySelector('#page3');
            container2.appendChild(renderer.domElement);

            
            var listener = new THREE.AudioListener();
            camera.add( listener );

            // create a global audio source
            var sound = new THREE.Audio( listener );
            var sound2 = new THREE.PositionalAudio( listener );

            // load a sound and set it as the Audio object's buffer
            var audioLoader = new THREE.AudioLoader();
            audioLoader.load( 'music/page3.flac', function( buffer ) {
                sound.setBuffer( buffer );
                sound.setLoop( true );
                sound.setVolume( 0.3 );
                sound.play();
            });      

            audioLoader.load( 'music/waternoise.wav', function( buffer ) {
                sound2.setBuffer( buffer );
                sound2.setRefDistance( 50 );
                sound2.play();
            });      

            /*---------------------------------------------------skyspere-----------------------------------------------------*/
            /*https://gist.github.com/rlama/04d6413f7ce7f621d20b*/

            createSky("duskdark", 0xCB253E, scene, 50);


            /*---------------------------------------------------water-------------------------------------------------------*/

            var waterGeo = new THREE.PlaneBufferGeometry( 1000, 1000 );
                    var water = new THREE.Water(
                        waterGeo,
                        {
                            textureWidth: 1000,
                            textureHeight: 1000,
                            waterNormals: new THREE.TextureLoader().load( 'textures/waternormals.jpg', function ( texture ) {
                                texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
                            } ),
                            scale: 10,
                            color: 0xffffff,
                            flowDirection: new THREE.Vector2( -2, 0 )
                            
                        }
                    );

                    water.rotation.x = - Math.PI / 2;
                    scene.add( water );
                    
                    water.add( sound2 );
                    
            /*-----------------------------------------------------Look around-----------------------------------------------------*/

            var controls = new THREE.OrbitControls( camera );
            controls.maxPolarAngle = Math.PI * 0.495;
                    controls.target.set( 0, 10, 0 );
                    controls.minDistance = 40.0;
                    controls.maxDistance = 200.0;
                    camera.lookAt( controls.target );
                
            /*-----------------------------------------------------functions and lights-----------------------------------------------------*/

            var ambLight = new THREE.AmbientLight( 0xc3b4e4 , .5 ); 
            scene.add(ambLight);
            
            camera.position.z = 5;
            function animate() {
                requestAnimationFrame( animate );
                renderer.render( scene, camera );
            }   

            animate();

            function createSky(name, sunColor, sceneNum, sunHeight) {
                var skyGeo = new THREE.SphereGeometry(1000, 50, 50); 
                var loader  = new THREE.TextureLoader(),
                texture = loader.load( "img/" + name + ".jpg" );

                var material = new THREE.MeshPhongMaterial({ 
                    map: texture,
                });

                var sky = new THREE.Mesh(skyGeo, material);
                sky.material.side = THREE.BackSide;
                sceneNum.add(sky);

                var sun = new THREE.SphereBufferGeometry( 300, 30, 100 );

                var light1 = new THREE.PointLight( sunColor , .2 );
                light1.add( new THREE.Mesh( sun, new THREE.MeshBasicMaterial( { color: sunColor } ) ) );
                light1.position.set(1000, sunHeight, 0);
                sceneNum.add( light1);

                var sunRay = new THREE.DirectionalLight(sunColor , .5);
                sunRay.target.position.set(1000, sunHeight, 0);
                sceneNum.add( sunRay, sunRay.target);


            }
        
        </script>
</body>
</html>